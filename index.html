<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Bud≈ºet Domowy</title>
<style>
  /* Stylizacja jak poprzednio */
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #1e1e1e;
    color: #d4af37;
    padding: 2rem;
    max-width: 800px;
    margin: auto;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  section {
    background: #2c2c2c;
    padding: 1rem 2rem;
    margin-bottom: 2rem;
    border-radius: 12px;
    box-shadow: 0 4px 8px rgba(212, 175, 55, 0.3);
    border: 1px solid #d4af37;
  }
  h1, h2 {
    text-align: center;
    color: #ffd966;
    margin-bottom: 0.5rem;
  }
  label {
    display: block;
    margin-top: 1rem;
    font-weight: 600;
    color: #ffd966;
  }
  input[type="number"], input[type="text"], select {
    box-sizing: border-box;
    padding: 0.5rem 0.8rem;
    margin-top: 0.3rem;
    border-radius: 6px;
    border: 1px solid #d4af37;
    background: #3b3b3b;
    color: #ffd966;
    font-size: 1rem;
    transition: border-color 0.3s ease;
    display: inline-block;
    vertical-align: middle;
  }
  input[type="number"], input[type="text"] {
    width: 60%;
    max-width: 300px;
  }
  select {
    width: auto;
    min-width: 160px;
  }
  input[type="number"]:focus, input[type="text"]:focus, select:focus {
    outline: none;
    border-color: #ffd966;
    background: #444;
    color: #fff;
  }
  button {
    margin-top: 0.5rem;
    padding: 0.4rem 1rem;
    background: #d4af37;
    color: #1e1e1e;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 700;
    font-size: 0.9rem;
    transition: background-color 0.3s ease;
    vertical-align: middle;
  }
  button:hover {
    background: #ffd966;
    color: #1a1a1a;
  }
  .result {
    font-size: 1.1rem;
    font-weight: bold;
    white-space: pre-wrap;
    color: #fff3b0;
    background: #3b3b3b;
    padding: 1rem;
    border-radius: 8px;
    border: 1px solid #d4af37;
    margin-top: 1rem;
  }
  ul {
    padding-left: 1.5rem;
    color: #f0d77a;
    max-height: 150px;
    overflow-y: auto;
    margin-top: 0.5rem;
    border: 1px solid #d4af37;
    border-radius: 8px;
    background: #3b3b3b;
  }
  .flex-row {
    display: flex;
    align-items: center;
    gap: 0.6rem;
    margin-top: 0.6rem;
  }
  .flex-row input[type="text"] {
    width: 40%;
  }
  .flex-row input[type="number"] {
    width: 30%;
  }
  .expense-button {
    background-color: #b22222;
    color: white;
    padding: 0.4rem 0.7rem;
    border-radius: 6px;
    font-weight: 700;
    font-size: 0.8rem;
    min-width: 70px;
  }
  /* Responsywno≈õƒá */
  @media (max-width: 480px) {
    body {
      padding: 1rem;
    }
    section {
      padding: 1rem;
      margin-bottom: 1.5rem;
    }
    button {
      max-width: 100%;
    }
    input[type="number"], input[type="text"] {
      font-size: 1.1rem;
      width: 100% !important;
    }
    label {
      font-size: 1rem;
    }
    h1 {
      font-size: 1.8rem;
    }
    h2 {
      font-size: 1.4rem;
    }
    .result {
      font-size: 1rem;
    }
    .flex-row {
      flex-direction: column;
      align-items: flex-start;
    }
    .flex-row input[type="text"], .flex-row input[type="number"], .flex-row button {
      width: 100% !important;
      margin-top: 0.3rem;
    }
  }
</style>
</head>
<body>
  <h1>Bud≈ºet Domowy</h1>

  <section id="incomeSection">
    <h2>Wp≈Çywy</h2>
    <div id="incomeList"></div>
    <button onclick="addIncome()">‚ûï Dodaj wp≈Çyw</button>
  </section>

  <section id="fixedExpensesSection">
    <h2>Wydatki sta≈Çe</h2>
    <div id="fixedExpensesList"></div>
    <button onclick="addFixedExpense()">‚ûï Dodaj wydatek sta≈Çy</button>
  </section>

  <section id="subscriptionsSection">
    <h2>Subskrypcje</h2>
    <div id="subscriptionsList"></div>
    <button onclick="addSubscription()">‚ûï Dodaj subskrypcjƒô</button>
  </section>

  <section>
    <h2>Wydatki ad hoc, uzupe≈Çniane po ka≈ºdym zakupie</h2>
    <label for="expenseCategory">Kategoria:</label>
    <select id="expenseCategory" onchange="categoryChanged()">
      <option value="">-- Wybierz kategoriƒô --</option>
      <option value="spozywka">Spo≈ºywka</option>
      <option value="restauracje">Restauracje</option>
      <option value="paliwo">Paliwo</option>
      <option value="wakacje">Wakacje</option>
      <option value="inne">Inne</option>
    </select>

    <label id="subcategoryLabel" style="display:none; margin-top: 1rem;" for="expenseSubcategory">Podkategoria:</label>
    <select id="expenseSubcategory" style="display:none;">
      <option value="">-- Wybierz podkategoriƒô --</option>
    </select>

    <label for="expenseDesc">Opis wydatku (opcjonalny):</label>
    <input type="text" id="expenseDesc" />
    <label for="expenseAmount">Kwota wydatku:</label>
    <input type="number" id="expenseAmount" />
    <button onclick="addExpense()">‚ûï Dodaj wydatek</button>
  </section>

  <section>
    <h2>Podsumowanie</h2>
    <p id="summaryText" class="result"></p>
    <h3>Wydatki ad hoc:</h3>
    <ul id="expenseList"></ul>
    <button onclick="resetBin()">üßπ Resetuj dane (ostrze≈ºenie!)</button>
  </section>

  <div style="text-align:center; margin-top:2rem;">
    <button onclick="saveData()">üíæ Zapisz dane</button>
  </div>

  <script>
    const binId = "688a2a2c7b4b8670d8a9e071";
    const masterKey = "$2a$10$PrRx.RBOnJmEFTqQQLH/Tu8TXFwoNEI.j/XEFF19EYFYELKzSX9BC";
    const apiUrl = `https://api.jsonbin.io/v3/b/${binId}/latest`;

    let incomes = [];
    let fixedExpenses = [];
    let subscriptions = [];
    let adHocExpenses = [];

    const options = {
      spozywka: ['Biedronka', 'Lidl', '≈ªabka', 'Carrefour', 'Auchan'],
      restauracje: ['McDonald\'s', 'KFC', 'Lokal', 'Kawiarnia', 'Inne', 'Dow√≥z'],
      paliwo: ['Orlen', 'Shell', 'Statoil', 'BP'],
      wakacje: ['Hotel', 'Bilety', 'Wycieczka', 'Inne'],
      inne: ['R√≥≈ºne']
    };

    function createInputRow(container, dataArray, index) {
      const div = document.createElement("div");
      div.className = "flex-row";

      const nameInput = document.createElement("input");
      nameInput.type = "text";
      nameInput.value = dataArray[index].name;
      nameInput.placeholder = "Nazwa";
      nameInput.oninput = () => {
        dataArray[index].name = nameInput.value;
        updateSummary();
      };

      const amountInput = document.createElement("input");
      amountInput.type = "number";
      amountInput.min = "0";
      amountInput.step = "0.01";
      amountInput.value = dataArray[index].amount;
      amountInput.placeholder = "Kwota";
      amountInput.oninput = () => {
        let val = parseFloat(amountInput.value);
        if (isNaN(val) || val < 0) val = 0;
        dataArray[index].amount = val;
        updateSummary();
      };

      const removeButton = document.createElement("button");
      removeButton.textContent = "Usu≈Ñ";
      removeButton.className = "expense-button";
      removeButton.onclick = () => {
        dataArray.splice(index, 1);
        renderAll();
        updateSummary();
      };

      div.appendChild(nameInput);
      div.appendChild(amountInput);
      div.appendChild(removeButton);

      container.appendChild(div);
    }

    function renderAll() {
      const incomeList = document.getElementById("incomeList");
      incomeList.innerHTML = "";
      incomes.forEach((_, i) => createInputRow(incomeList, incomes, i));

      const fixedExpensesList = document.getElementById("fixedExpensesList");
      fixedExpensesList.innerHTML = "";
      fixedExpenses.forEach((_, i) => createInputRow(fixedExpensesList, fixedExpenses, i));

      const subscriptionsList = document.getElementById("subscriptionsList");
      subscriptionsList.innerHTML = "";
      subscriptions.forEach((_, i) => createInputRow(subscriptionsList, subscriptions, i));

      renderAdHocExpenses();
      updateSummary();
    }

    function addIncome() {
      incomes.push({ name: "", amount: 0 });
      renderAll();
      updateSummary();
    }
    function addFixedExpense() {
      fixedExpenses.push({ name: "", amount: 0 });
      renderAll();
      updateSummary();
    }
    function addSubscription() {
      subscriptions.push({ name: "", amount: 0 });
      renderAll();
      updateSummary();
    }

    function renderAdHocExpenses() {
  const expenseList = document.getElementById("expenseList");
  expenseList.innerHTML = "";
  adHocExpenses.forEach((exp, index) => {
    const li = document.createElement("li");
    li.textContent = `${exp.category} - ${exp.subcategory ? exp.subcategory + ": " : ""}${exp.description || ""} - ${exp.amount.toFixed(2)} PLN`;
    
    const removeBtn = document.createElement("button");
    removeBtn.textContent = "Usu≈Ñ";
    removeBtn.className = "expense-button";
    removeBtn.style.marginLeft = "1rem";
    removeBtn.onclick = () => {
      adHocExpenses.splice(index, 1);
      renderAdHocExpenses();
      updateSummary();
    };

    li.appendChild(removeBtn);
    expenseList.appendChild(li);
  });
}

    function categoryChanged() {
      const category = document.getElementById("expenseCategory").value;
      const subcategorySelect = document.getElementById("expenseSubcategory");
      const subcategoryLabel = document.getElementById("subcategoryLabel");

      if (!category || !options[category]) {
        subcategorySelect.style.display = "none";
        subcategoryLabel.style.display = "none";
        subcategorySelect.innerHTML = "";
        return;
      }

      const subs = options[category];
      subcategorySelect.innerHTML = '<option value="">-- Wybierz podkategoriƒô --</option>';
      subs.forEach(sub => {
        const opt = document.createElement("option");
        opt.value = sub;
        opt.textContent = sub;
        subcategorySelect.appendChild(opt);
      });
      subcategorySelect.style.display = "inline-block";
      subcategoryLabel.style.display = "block";
    }

    function addExpense() {
      const category = document.getElementById("expenseCategory").value;
      const subcategory = document.getElementById("expenseSubcategory").value;
      const description = document.getElementById("expenseDesc").value.trim();
      const amountStr = document.getElementById("expenseAmount").value;

      if (!category) {
        alert("Proszƒô wybraƒá kategoriƒô.");
        return;
      }
      const amount = parseFloat(amountStr);
      if (isNaN(amount) || amount <= 0) {
        alert("Podaj poprawnƒÖ kwotƒô wydatku.");
        return;
      }

      adHocExpenses.push({ category, subcategory, description, amount });
      renderAdHocExpenses();
      updateSummary();

      // reset inputy
      document.getElementById("expenseCategory").value = "";
      document.getElementById("expenseSubcategory").style.display = "none";
      document.getElementById("subcategoryLabel").style.display = "none";
      document.getElementById("expenseSubcategory").innerHTML = "";
      document.getElementById("expenseDesc").value = "";
      document.getElementById("expenseAmount").value = "";
    }

    function resetBin() {
      if (confirm("Czy na pewno chcesz zresetowaƒá wszystkie dane?")) {
        incomes = [];
        fixedExpenses = [];
        subscriptions = [];
        adHocExpenses = [];
        renderAll();
        updateSummary();
      }
    }

    function updateSummary() {
      const totalIncome = incomes.reduce((acc, i) => acc + i.amount, 0);
      const totalFixed = fixedExpenses.reduce((acc, e) => acc + e.amount, 0);
      const totalSubs = subscriptions.reduce((acc, s) => acc + s.amount, 0);
      const totalAdHoc = adHocExpenses.reduce((acc, a) => acc + a.amount, 0);
      const totalExpenses = totalFixed + totalSubs + totalAdHoc;
      const balance = totalIncome - totalExpenses;

      let summaryText = `Suma wp≈Çyw√≥w: ${totalIncome.toFixed(2)} PLN\n`;
      summaryText += `Wydatki sta≈Çe: ${totalFixed.toFixed(2)} PLN\n`;
      summaryText += `Subskrypcje: ${totalSubs.toFixed(2)} PLN\n`;
      summaryText += `Wydatki ad hoc: ${totalAdHoc.toFixed(2)} PLN\n`;
      summaryText += `----------------------------\n`;
      summaryText += `Saldo: ${balance.toFixed(2)} PLN`;

      const summaryElem = document.getElementById("summaryText");
      summaryElem.textContent = summaryText;
    }

    async function saveData() {
      const data = {
        incomes,
        fixedExpenses,
        subscriptions,
        adHocExpenses
      };

      try {
        const response = await fetch(`https://api.jsonbin.io/v3/b/${binId}`, {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
            "X-Master-Key": masterKey,
          },
          body: JSON.stringify(data)
        });

        if (response.ok) {
          alert("Dane zosta≈Çy zapisane pomy≈õlnie!");
        } else {
          alert("B≈ÇƒÖd podczas zapisu danych.");
        }
      } catch (error) {
        alert("B≈ÇƒÖd po≈ÇƒÖczenia: " + error);
      }
    }

    async function loadData() {
      try {
        const response = await fetch(apiUrl, {
          headers: {
            "X-Master-Key": masterKey,
          }
        });
        if (!response.ok) throw new Error(`B≈ÇƒÖd sieci: ${response.status}`);

        const json = await response.json();
        if (json && json.record) {
          incomes = json.record.incomes || [];
          fixedExpenses = json.record.fixedExpenses || [];
          subscriptions = json.record.subscriptions || [];
          adHocExpenses = json.record.adHocExpenses || [];
        }
      } catch (err) {
        console.warn("Nie uda≈Ço siƒô wczytaƒá danych:", err);
      } finally {
        renderAll();
      }
    }

    // ≈Åadujemy dane przy starcie strony
    window.onload = loadData;
  </script>
	<footer> 
	<br><br></br></br>
    <center>&copy; 2025 Copyright by <b>Pawe≈Ç Chrzan</b>,  Wszelkie prawa zastrze≈ºone!</center>
  </footer>

</body>
</html>
